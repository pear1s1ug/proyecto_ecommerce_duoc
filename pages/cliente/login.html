<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Iniciar Sesi√≥n - Hazel Lab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="../../css/cliente-styles.css">
</head>
<body class="d-flex flex-column min-vh-100">
  <header class="p-3  d-flex justify-content-between align-items-center">
    <div id="logo">
      <a href="../../index.html" class="text-white font-weight-bold" style="font-size: 1.2rem; text-decoration: none;">
        Hazelüå∞Lab
      </a>
    </div>
  </header>

  <main class="container my-5">
    <div class="col-md-5 mx-auto">
      <h2 class="text-center mb-4">Iniciar Sesi√≥n</h2>
      <form id="form-login" class="border p-4 rounded bg-light shadow-sm">
        <div class="form-group">
          <label for="correo">Correo electr√≥nico</label>
          <input type="email" class="form-control" id="correo" name="correo" required maxlength="100" placeholder="admin@duoc.cl">
        </div>
        <div class="form-group">
          <label for="clave">Contrase√±a</label>
          <input type="password" class="form-control" id="clave" name="clave" required minlength="4" maxlength="10" placeholder="admin123">
        </div>

        <div class="d-flex justify-content-between align-items-center mb-3">
          <button type="submit" class="btn btn-primary">Ingresar</button>
          <a href="registro.html">¬øNo tienes cuenta? Reg√≠strate</a>
        </div>

        <div class="text-center mt-3">
          <a href="../../index.html" class="btn btn-secondary">‚Üê Volver al Home</a>
          <button type="button" class="btn btn-warning mt-2" onclick="debugLogin()">Debug Info</button>
        </div>
      </form>
      
      <!-- Panel de debug -->
      <div id="debug-info" class="mt-4 p-3 bg-light border rounded" style="display: none;">
        <h5>Informaci√≥n de Debug</h5>
        <pre id="debug-content"></pre>
      </div>
    </div>
  </main>

  <!-- Incluir admin-scripts.js para tener acceso a los datos -->
  <script src="../../js/admin-scripts.js"></script>
  
  <script>
    // Usar la funci√≥n global obtenerClientes del admin-scripts.js
    function obtenerUsuarios() {
      // Siempre obtener clientes usando la funci√≥n global (ya normaliza 'correo')
      return (typeof obtenerClientes === "function") ? obtenerClientes() : [];
    }

    // Funci√≥n de debug
    function debugLogin() {
      const debugDiv = document.getElementById("debug-info");
      const debugContent = document.getElementById("debug-content");
      
      const clientes = obtenerUsuarios();
      const productos = (typeof obtenerProductos === "function" ? obtenerProductos() : []);
      
      const debugInfo = {
        localStorageKeys: Object.keys(localStorage),
        clientes: clientes,
        productosCount: productos.length,
        usuarioActivo: JSON.parse(localStorage.getItem("usuarioActivo"))
      };
      
      debugContent.textContent = JSON.stringify(debugInfo, null, 2);
      debugDiv.style.display = 'block';
    }

    // Validaci√≥n de correo permitidos
    function validarCorreo(correo) {
      const regex = /^[a-zA-Z0-9._%+-]+@(duoc\.cl|profesor\.duoc\.cl|gmail\.com)$/;
      return regex.test(correo);
    }

    // Listener de formulario
    document.getElementById("form-login").addEventListener("submit", function(e) {
      e.preventDefault();

      const correoInput = document.getElementById("correo");
      const claveInput = document.getElementById("clave");
      const correo = correoInput.value.trim().toLowerCase();
      const clave = claveInput.value.trim();

      if (!validarCorreo(correo)) {
        alert("Correo inv√°lido. Solo se permiten @duoc.cl, @profesor.duoc.cl o @gmail.com");
        correoInput.value = "";
        claveInput.value = "";
        return;
      }

      const usuarios = obtenerUsuarios();

      // Buscar usuario (ya est√° normalizado a 'correo')
      const usuarioEncontrado = usuarios.find(u => 
        u.correo && u.correo.toLowerCase() === correo && u.clave === clave
      );

      if (usuarioEncontrado) {
        localStorage.setItem("usuarioActivo", JSON.stringify(usuarioEncontrado));
        alert("¬°Bienvenido " + usuarioEncontrado.nombre + "!");

        if (usuarioEncontrado.tipoUsuario === "Administrador") {
          window.location.href = "../admin/menu-admin.html";
        } else {
          window.location.href = "../../index.html";
        }
      } else {
        alert("Correo o contrase√±a incorrectos");
        claveInput.value = "";
      }
    });

    // Auto-rellenar para testing
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('correo').value = 'admin@duoc.cl';
      document.getElementById('clave').value = 'admin123';
    });
  </script>
  <footer class=" text-center py-3 mt-auto">
    <p class="mb-0">¬© 2025 DUOC</p>
  </footer>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>