<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Nuevo Cliente</title>
  <link rel="stylesheet" href="../../css/admin-styles.css">
</head>
<body>
  <div id="container">
    <!-- Sidebar -->
    <aside id="menu-sidebar">
      <div id="logo">Hazel游꺓Lab</div>
      <nav id="menu">
        <ul>
          <li><a href="menu-admin.html" class="active">Dashboard</a></li>
          <li><a href="vista-clientes.html">Ver Clientes</a></li>
          <li><a href="vista-productos.html">Ver Inventario</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main -->
    <main id="main">
      <header id="header">
        <h2>Nuevo Cliente</h2>
      </header>

      <section id="form-section">
        <form id="nuevoClienteForm">
          <fieldset>
            <legend>Registro de cliente</legend>

            <label for="run">RUN</label>
            <input type="text" id="run" name="run" required minlength="7" maxlength="9" placeholder="19011022K">

            <label for="nombre">Nombre</label>
            <input type="text" id="nombre" name="nombre" required maxlength="50">

            <label for="apellidos">Apellidos</label>
            <input type="text" id="apellidos" name="apellidos" required maxlength="100">

            <label for="correo">Correo</label>
            <input type="email" id="correo" name="correo" required maxlength="100">

            <label for="fechaNacimiento">Fecha de Nacimiento</label>
            <input type="date" id="fechaNacimiento" name="fechaNacimiento">

            <label for="tipoUsuario">Tipo de Usuario</label>
            <select id="tipoUsuario" name="tipoUsuario">
              <option value="">Seleccione el tipo</option>
              <option value="Administrador">Administrador</option>
              <option value="Cliente">Cliente</option>
              <option value="Vendedor">Vendedor</option>
            </select>

            <label for="region">Regi칩n</label>
            <select id="region" name="region" required></select>

            <label for="comuna">Comuna</label>
            <select id="comuna" name="comuna" required></select>

            <label for="direccion">Direcci칩n</label>
            <input type="text" id="direccion" name="direccion" required maxlength="300">

            <label for="clave">Contrase침a</label>
            <input type="password" id="clave" name="clave" required minlength="4" maxlength="10">

            <label for="confirmarClave">Confirmar Contrase침a</label>
            <input type="password" id="confirmarClave" name="confirmarClave" required minlength="4" maxlength="10">
          </fieldset>

          <div class="form-actions">
            <button type="submit">Registrar</button>
          </div>
        </form>
      </section>
    </main>
  </div>

  <script src="../../js/admin-scripts.js"></script>
  <script>
    // Llenar select de regiones y comunas
    llenarRegionesYComunas("region", "comuna");

    // Manejo del formulario de nuevo cliente
    document.getElementById("nuevoClienteForm").addEventListener("submit", function(e){
      e.preventDefault();

      const run = document.getElementById("run").value.trim();
      const nombre = document.getElementById("nombre").value.trim();
      const apellidos = document.getElementById("apellidos").value.trim();
      const correo = document.getElementById("correo").value.trim();
      const fechaNacimiento = document.getElementById("fechaNacimiento").value;
      const tipoUsuario = document.getElementById("tipoUsuario").value;
      const region = document.getElementById("region").value;
      const comuna = document.getElementById("comuna").value;
      const direccion = document.getElementById("direccion").value.trim();
      const clave = document.getElementById("clave").value.trim();
      const confirmarClave = document.getElementById("confirmarClave").value.trim();

      // Validaci칩n de contrase침a
      if(clave.length < 4 || clave.length > 10){
        alert("La contrase침a debe tener entre 4 y 10 caracteres");
        return;
      }
      if(clave !== confirmarClave){
        alert("Las contrase침as no coinciden");
        return;
      }

      // Validaciones RUN y correo
      if(!validarRun(run)){
        alert("RUN inv치lido. Debe ser sin puntos ni guion, ej: 19011022K");
        return;
      }
      if(!validarCorreo(correo)){
        alert("Correo inv치lido. Solo se permiten @duoc.cl, @profesor.duoc.cl o @gmail.com");
        return;
      }

      const clientes = obtenerClientes();
      if (clientes.some(c => c.id === run)) {
        alert("El RUN ya est치 registrado");
        return;
      }

      // Guardar en un solo objeto (siempre usar 'correo', no 'email')
      const nuevoCliente = {
        id: run,
        nombre,
        apellidos,
        correo,
        fechaNacimiento,
        tipoUsuario,
        region,
        comuna,
        direccion,
        clave
      };

      clientes.push(nuevoCliente);
      guardarClientes(clientes);
      alert("Cliente registrado correctamente");
      window.location.href = "vista-clientes.html";
    });
  </script>
</body>
</html>